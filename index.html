<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Realtime Editor</title>
	<link rel="stylesheet" href="">
</head>
<body>
	<textarea name="" id="note" cols="100" rows="20"></textarea>

	<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

	<script>
		var socket = io();
		var note = document.getElementById('note');
		socket.on('update', function (data) {
			console.log('updated')
			console.log('friend start: ', data.start)


			var start = note.selectionStart,
        	end = note.selectionEnd;
        	console.log('my start: ', start);

			if(typeof data == 'object') {
				note.value = data.content;
			}
			else {
				note.value = data;
			}
			
			if(data.start < start) {
				note.setSelectionRange(start + 1, end + 1);
			}
			else {
				note.setSelectionRange(start, end);
			}
			
		})
		note.addEventListener('input', function(event) {
			socket.emit('content', {content: event.target.value, 'start': note.selectionStart, 'end': note.selectionEnd});

			// console.log(event.target.value);
		})
		// console.log(note)
	</script>
</body>
</html>